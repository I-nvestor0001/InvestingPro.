<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Investment Hub - Grow Your Wealth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 150px 2rem 100px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .cta-button {
            background: white;
            color: #667eea;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .cta-button:hover {
            transform: scale(1.05);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: #667eea;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .plan-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .plan-card:hover {
            transform: translateY(-10px);
        }

        .plan-name {
            font-size: 1.8rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .plan-amount {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }

        .invest-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            width: 100%;
            cursor: pointer;
            font-weight: bold;
        }

        .dashboard {
            display: none;
            min-height: 100vh;
            padding-top: 80px;
        }

        .dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .item {
            background: #f8f9fa;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 0.5rem;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 10px;
            color: white;
            z-index: 3000;
            animation: slideIn 0.3s;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #666;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="notification"></div>

    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">ðŸ’Ž Prime Investment Hub</div>
            <ul class="nav-links" id="navLinks">
                <li><a onclick="showPage('home')">Home</a></li>
                <li><a onclick="showPage('plans')">Plans</a></li>
                <li id="dashboardLink" style="display: none;"><a onclick="showDashboard()">Dashboard</a></li>
                <li id="logoutLink" style="display: none;"><a onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </header>

    <!-- Home Page -->
    <div id="homePage" class="page active">
        <section class="hero">
            <h1>Grow Your Wealth with Confidence</h1>
            <p>Secure investments with guaranteed 70% returns</p>
            <button class="cta-button" onclick="showModal('registerModal')">Get Started Today</button>
        </section>

        <section class="container" id="plans">
            <h2 class="section-title">Investment Plans</h2>
            <div class="plans-grid" id="plansGrid"></div>
        </section>
    </div>

    <!-- User Dashboard -->
    <div id="userDashboard" class="dashboard container">
        <h2 class="section-title">My Dashboard</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="userBalance">â‚¦0</div>
                <p>Available Balance</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="userInvested">â‚¦0</div>
                <p>Total Invested</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="userReferrals">0</div>
                <p>Total Referrals</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="userEarnings">â‚¦0</div>
                <p>Referral Earnings</p>
            </div>
        </div>

        <div class="card">
            <h3>Your Referral Code</h3>
            <div style="background: #667eea; color: white; padding: 1rem; border-radius: 10px; text-align: center; font-size: 1.5rem; margin: 1rem 0;">
                <span id="userRefCode">Loading...</span>
            </div>
            <p>Share this code to earn â‚¦1,200 per referral!</p>
        </div>

        <div class="card">
            <h3>Quick Actions</h3>
            <button class="btn btn-primary" onclick="showModal('withdrawModal')">Request Withdrawal</button>
            <button class="btn btn-success" onclick="showModal('investModal')">New Investment</button>
        </div>

        <div class="card">
            <h3>My Investments</h3>
            <div id="userInvestmentsList"></div>
        </div>

        <div class="card">
            <h3>Withdrawal History</h3>
            <div id="userWithdrawalsList"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard container">
        <h2 class="section-title">Admin Dashboard</h2>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">0</div>
                <p>Total Users</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalInvestments">0</div>
                <p>Total Investments</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalInvested">â‚¦0</div>
                <p>Total Invested Amount</p>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingWithdrawals">0</div>
                <p>Pending Withdrawals</p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('users')">Users</button>
            <button class="tab" onclick="switchTab('investments')">Investments</button>
            <button class="tab" onclick="switchTab('withdrawals')">Withdrawals</button>
            <button class="tab" onclick="switchTab('activities')">Recent Activities</button>
        </div>

        <div id="usersTab" class="card">
            <h3>All Users</h3>
            <div id="usersList"></div>
        </div>

        <div id="investmentsTab" class="card" style="display: none;">
            <h3>All Investments</h3>
            <div id="investmentsList"></div>
        </div>

        <div id="withdrawalsTab" class="card" style="display: none;">
            <h3>Withdrawal Requests</h3>
            <div id="withdrawalsList"></div>
        </div>

        <div id="activitiesTab" class="card" style="display: none;">
            <h3>Recent Activities</h3>
            <div id="activitiesList"></div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h2>Create Account</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="submit-btn">Register</button>
                <p style="margin-top: 1rem; text-align: center;">Already have an account? <a href="#" onclick="showModal('loginModal'); return false;">Login</a></p>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="submit-btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Investment Modal -->
    <div id="investModal" class="modal">
        <div class="modal-content">
            <h2>New Investment</h2>
            <form id="investmentForm">
                <div class="form-group">
                    <label>Select Plan</label>
                    <select name="plan" id="planSelect" required></select>
                </div>
                <div class="form-group">
                    <label>Referral Code (Optional)</label>
                    <input type="text" name="referralCode">
                </div>
                <div style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin: 1rem 0;">
                    <p><strong>Payment Details:</strong></p>
                    <p>OPAY Account: 6141876934</p>
                    <p>Send payment and describe transaction below</p>
                </div>
                <div class="form-group">
                    <label>Payment Proof / Transaction Reference</label>
                    <textarea name="paymentProof" rows="3" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Submit Investment</button>
            </form>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <h2>Request Withdrawal</h2>
            <form id="withdrawalForm">
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" required min="1000">
                </div>
                <div class="form-group">
                    <label>Bank Name</label>
                    <input type="text" name="bankName" required>
                </div>
                <div class="form-group">
                    <label>Account Number</label>
                    <input type="text" name="accountNumber" required>
                </div>
                <div class="form-group">
                    <label>Account Name</label>
                    <input type="text" name="accountName" required>
                </div>
                <button type="submit" class="submit-btn">Submit Request</button>
            </form>
        </div>
    </div>

    <script>
        const ADMIN_EMAIL = 'UDOFIAJOSHUA04@GMAIL.COM';
        const ADMIN_PASSWORD = 'Saturday1234$';
        
        let currentUser = null;
        let users = [];
        let investments = [];
        let withdrawals = [];
        let activities = [];

        const plans = [
            { name: 'Starter', amount: 3000, returns: 5100 },
            { name: 'Basic', amount: 5000, returns: 8500 },
            { name: 'Standard', amount: 10000, returns: 17000 },
            { name: 'Premium', amount: 20000, returns: 34000 },
            { name: 'Gold', amount: 30000, returns: 51000 },
            { name: 'Platinum', amount: 40000, returns: 68000 }
        ];

        // Initialize
        window.onload = async () => {
            await loadData();
            renderPlans();
            checkAuth();
        };

        // Auto-refresh for admin
        setInterval(async () => {
            if (currentUser && currentUser.email === ADMIN_EMAIL) {
                await loadData();
                updateAdminDashboard();
            }
        }, 5000);

        async function loadData() {
            try {
                const [u, i, w, a, cu] = await Promise.all([
                    window.storage.get('users', true),
                    window.storage.get('investments', true),
                    window.storage.get('withdrawals', true),
                    window.storage.get('activities', true),
                    window.storage.get('currentUser', false)
                ]);

                if (u?.value) users = JSON.parse(u.value);
                if (i?.value) investments = JSON.parse(i.value);
                if (w?.value) withdrawals = JSON.parse(w.value);
                if (a?.value) activities = JSON.parse(a.value);
                if (cu?.value) currentUser = JSON.parse(cu.value);
            } catch (e) {
                console.log('Loading fresh data');
            }
        }

        async function saveData() {
            await window.storage.set('users', JSON.stringify(users), true);
            await window.storage.set('investments', JSON.stringify(investments), true);
            await window.storage.set('withdrawals', JSON.stringify(withdrawals), true);
            await window.storage.set('activities', JSON.stringify(activities), true);
            if (currentUser) {
                await window.storage.set('currentUser', JSON.stringify(currentUser), false);
            }
        }

        function showNotification(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `notification ${type}`;
            div.textContent = message;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 3000);
            
            // Play sound
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUKzn77ljHAU2jdXwz3k=');
            audio.play().catch(() => {});
        }

        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page + 'Page').classList.add('active');
        }

        function renderPlans() {
            const grid = document.getElementById('plansGrid');
            const select = document.getElementById('planSelect');
            
            grid.innerHTML = plans.map(p => `
                <div class="plan-card">
                    <h3 class="plan-name">${p.name} Plan</h3>
                    <div class="plan-amount">â‚¦${p.amount.toLocaleString()}</div>
                    <p style="color: #28a745; font-size: 1.2rem;">Returns: â‚¦${p.returns.toLocaleString()}</p>
                    <p style="color: #666; margin: 1rem 0;">Duration: 7 Days</p>
                    <button class="invest-button" onclick="${currentUser ? `showModal('investModal')` : `showModal('registerModal')`}">Invest Now</button>
                </div>
            `).join('');

            select.innerHTML = plans.map(p => 
                `<option value="${p.name}">${p.name} - â‚¦${p.amount.toLocaleString()} (Returns: â‚¦${p.returns.toLocaleString()})</option>`
            ).join('');
        }

        document.getElementById('registerForm').onsubmit = async (e) => {
            e.preventDefault();
            const fd = new FormData(e.target);
            
            if (users.find(u => u.email === fd.get('email'))) {
                showNotification('Email already registered!', 'error');
                return;
            }

            const user = {
                id: Date.now(),
                name: fd.get('name'),
                email: fd.get('email'),
                phone: fd.get('phone'),
                password: fd.get('password'),
                referralCode: 'REF' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                balance: 0,
                totalInvested: 0,
                referralCount: 0,
                earnings: 0,
                created: new Date().toISOString()
            };

            users.push(user);
            activities.push({
                type: 'User Registration',
                user: user.name,
                time: new Date().toISOString()
            });
            
            await saveData();
            showNotification('Registration successful! Please login.');
            closeModal('registerModal');
            e.target.reset();
            showModal('loginModal');
        };

        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            const fd = new FormData(e.target);
            const email = fd.get('email');
            const password = fd.get('password');

            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                currentUser = { email: ADMIN_EMAIL, isAdmin: true };
                await saveData();
                showNotification('Admin login successful!');
                closeModal('loginModal');
                showDashboard();
                return;
            }

            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                await saveData();
                showNotification('Login successful!');
                closeModal('loginModal');
                showDashboard();
            } else {
                showNotification('Invalid credentials!', 'error');
            }
        };

        document.getElementById('investmentForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!currentUser || currentUser.isAdmin) return;

            const fd = new FormData(e.target);
            const planName = fd.get('plan');
            const plan = plans.find(p => p.name === planName);
            const refCode = fd.get('referralCode');

            const investment = {
                id: Date.now(),
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                plan: planName,
                amount: plan.amount,
                returns: plan.returns,
                referralCode: refCode,
                paymentProof: fd.get('paymentProof'),
                status: 'Pending',
                created: new Date().toISOString()
            };

            investments.push(investment);
            activities.push({
                type: 'New Investment',
                user: currentUser.name,
                amount: plan.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Investment submitted! Awaiting approval.');
            closeModal('investModal');
            e.target.reset();
            updateUserDashboard();
        };

        document.getElementById('withdrawalForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!currentUser || currentUser.isAdmin) return;

            const fd = new FormData(e.target);
            
            const withdrawal = {
                id: Date.now(),
                userId: currentUser.id,
                userName: currentUser.name,
                userEmail: currentUser.email,
                amount: parseInt(fd.get('amount')),
                bankName: fd.get('bankName'),
                accountNumber: fd.get('accountNumber'),
                accountName: fd.get('accountName'),
                status: 'Pending',
                created: new Date().toISOString()
            };

            withdrawals.push(withdrawal);
            activities.push({
                type: 'Withdrawal Request',
                user: currentUser.name,
                amount: withdrawal.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Withdrawal request submitted!');
            closeModal('withdrawModal');
            e.target.reset();
            updateUserDashboard();
        };

        function checkAuth() {
            if (currentUser) {
                document.getElementById('dashboardLink').style.display = 'block';
                document.getElementById('logoutLink').style.display = 'block';
            }
        }

        function showDashboard() {
            if (!currentUser) {
                showNotification('Please login first!', 'error');
                showModal('loginModal');
                return;
            }

            document.querySelectorAll('.page, .dashboard').forEach(p => p.classList.remove('active'));

            if (currentUser.isAdmin) {
                document.getElementById('adminDashboard').classList.add('active');
                updateAdminDashboard();
            } else {
                document.getElementById('userDashboard').classList.add('active');
                updateUserDashboard();
            }
        }

        function updateUserDashboard() {
            const userInv = investments.filter(i => i.userId === currentUser.id);
            const userWith = withdrawals.filter(w => w.userId === currentUser.id);
            const approved = userInv.filter(i => i.status === 'Approved');

            const totalInvested = approved.reduce((sum, i) => sum + i.amount, 0);
            const totalReturns = approved.reduce((sum, i) => sum + i.returns, 0);
            const referralEarnings = currentUser.referralCount * 1200;
            const balance = totalReturns + referralEarnings;

            document.getElementById('userBalance').textContent = 'â‚¦' + balance.toLocaleString();
            document.getElementById('userInvested').textContent = 'â‚¦' + totalInvested.toLocaleString();
            document.getElementById('userReferrals').textContent = currentUser.referralCount || 0;
            document.getElementById('userEarnings').textContent = 'â‚¦' + referralEarnings.toLocaleString();
            document.getElementById('userRefCode').textContent = currentUser.referralCode;

            document.getElementById('userInvestmentsList').innerHTML = userInv.length ? userInv.map(i => `
                <div class="item">
                    <strong>${i.plan} Plan</strong><br>
                    Amount: â‚¦${i.amount.toLocaleString()}<br>
                    Returns: â‚¦${i.returns.toLocaleString()}<br>
                    Status: <span style="color: ${i.status === 'Approved' ? 'green' : i.status === 'Rejected' ? 'red' : 'orange'}">${i.status}</span><br>
                    Date: ${new Date(i.created).toLocaleDateString()}
                </div>
            `).join('') : '<p>No investments yet</p>';

            document.getElementById('userWithdrawalsList').innerHTML = userWith.length ? userWith.map(w => `
                <div class="item">
                    Amount: â‚¦${w.amount.toLocaleString()}<br>
                    Bank: ${w.bankName}<br>
                    Account: ${w.accountNumber}<br>
                    Status: <span style="color: ${w.status === 'Paid' ? 'green' : w.status === 'Rejected' ? 'red' : 'orange'}">${w.status}</span><br>
                    Date: ${new Date(w.created).toLocaleDateString()}
                </div>
            `).join('') : '<p>No withdrawal requests yet</p>';
        }

        function updateAdminDashboard() {
            const totalInvestedAmount = investments.filter(i => i.status === 'Approved').reduce((sum, i) => sum + i.amount, 0);
            const pendingWith = withdrawals.filter(w => w.status === 'Pending').length;

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalInvestments').textContent = investments.length;
            document.getElementById('totalInvested').textContent = 'â‚¦' + totalInvestedAmount.toLocaleString();
            document.getElementById('pendingWithdrawals').textContent = pendingWith;

            // Users List
            document.getElementById('usersList').innerHTML = users.length ? users.map(u => {
                const userInv = investments.filter(i => i.userId === u.id);
                const approved = userInv.filter(i => i.status === 'Approved');
                const totalInv = approved.reduce((sum, i) => sum + i.amount, 0);

                return `
                    <div class="item">
                        <strong>${u.name}</strong><br>
                        Email: ${u.email}<br>
                        Phone: ${u.phone}<br>
                        Referral Code: ${u.referralCode}<br>
                        Total Investments: ${userInv.length}<br>
                        Total Invested: â‚¦${totalInv.toLocaleString()}<br>
                        Referrals: ${u.referralCount || 0}<br>
                        Joined: ${new Date(u.created).toLocaleDateString()}<br>
                        <button class="btn btn-danger" onclick="deleteUser(${u.id})">Delete User</button>
                    </div>
                `;
            }).join('') : '<p>No users yet</p>';

            // Investments List
            document.getElementById('investmentsList').innerHTML = investments.length ? investments.map(i => `
                <div class="item">
                    <strong>${i.userName}</strong> - ${i.plan} Plan<br>
                    Email: ${i.userEmail}<br>
                    Amount: â‚¦${i.amount.toLocaleString()}<br>
                    Returns: â‚¦${i.returns.toLocaleString()}<br>
                    Referral Code Used: ${i.referralCode || 'None'}<br>
                    Payment Proof: ${i.paymentProof}<br>
                    Date: ${new Date(i.created).toLocaleDateString()}<br>
                    Status: <span style="color: ${i.status === 'Approved' ? 'green' : i.status === 'Rejected' ? 'red' : 'orange'}">${i.status}</span><br>
                    ${i.status === 'Pending' ? `
                        <button class="btn btn-success" onclick="approveInvestment(${i.id})">Approve</button>
                        <button class="btn btn-danger" onclick="rejectInvestment(${i.id})">Reject</button>
                    ` : ''}
                </div>
            `).join('') : '<p>No investments yet</p>';

            // Withdrawals List
            document.getElementById('withdrawalsList').innerHTML = withdrawals.length ? withdrawals.map(w => `
                <div class="item">
                    <strong>${w.userName}</strong><br>
                    Email: ${w.userEmail}<br>
                    Amount: â‚¦${w.amount.toLocaleString()}<br>
                    Bank: ${w.bankName}<br>
                    Account Number: ${w.accountNumber}<br>
                    Account Name: ${w.accountName}<br>
                    Date: ${new Date(w.created).toLocaleDateString()}<br>
                    Status: <span style="color: ${w.status === 'Paid' ? 'green' : w.status === 'Rejected' ? 'red' : 'orange'}">${w.status}</span><br>
                    ${w.status === 'Pending' ? `
                        <button class="btn btn-success" onclick="approveWithdrawal(${w.id})">Mark as Paid</button>
                        <button class="btn btn-danger" onclick="rejectWithdrawal(${w.id})">Reject</button>
                    ` : ''}
                </div>
            `).join('') : '<p>No withdrawal requests yet</p>';

            // Recent Activities
            const recentActivities = [...activities].reverse().slice(0, 20);
            document.getElementById('activitiesList').innerHTML = recentActivities.length ? recentActivities.map(a => `
                <div class="item">
                    <strong>${a.type}</strong><br>
                    User: ${a.user}<br>
                    ${a.amount ? `Amount: â‚¦${a.amount.toLocaleString()}<br>` : ''}
                    Time: ${new Date(a.time).toLocaleString()}
                </div>
            `).join('') : '<p>No activities yet</p>';
        }

        async function approveInvestment(id) {
            const inv = investments.find(i => i.id === id);
            if (!inv) return;

            inv.status = 'Approved';

            // Credit referrer if referral code was used
            if (inv.referralCode) {
                const referrer = users.find(u => u.referralCode === inv.referralCode);
                if (referrer) {
                    const referrerHasInvestment = investments.some(i => i.userId === referrer.id && i.status === 'Approved');
                    if (referrerHasInvestment) {
                        referrer.referralCount = (referrer.referralCount || 0) + 1;
                        referrer.earnings = (referrer.earnings || 0) + 1200;
                    }
                }
            }

            activities.push({
                type: 'Investment Approved',
                user: inv.userName,
                amount: inv.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Investment approved!');
            updateAdminDashboard();
        }

        async function rejectInvestment(id) {
            const inv = investments.find(i => i.id === id);
            if (!inv) return;

            inv.status = 'Rejected';
            activities.push({
                type: 'Investment Rejected',
                user: inv.userName,
                amount: inv.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Investment rejected!');
            updateAdminDashboard();
        }

        async function approveWithdrawal(id) {
            const w = withdrawals.find(w => w.id === id);
            if (!w) return;

            w.status = 'Paid';
            activities.push({
                type: 'Withdrawal Paid',
                user: w.userName,
                amount: w.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Withdrawal marked as paid!');
            updateAdminDashboard();
        }

        async function rejectWithdrawal(id) {
            const w = withdrawals.find(w => w.id === id);
            if (!w) return;

            w.status = 'Rejected';
            activities.push({
                type: 'Withdrawal Rejected',
                user: w.userName,
                amount: w.amount,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('Withdrawal rejected!');
            updateAdminDashboard();
        }

        async function deleteUser(id) {
            if (!confirm('Are you sure you want to delete this user?')) return;

            const user = users.find(u => u.id === id);
            users = users.filter(u => u.id !== id);
            investments = investments.filter(i => i.userId !== id);
            withdrawals = withdrawals.filter(w => w.userId !== id);

            activities.push({
                type: 'User Deleted',
                user: user.name,
                time: new Date().toISOString()
            });

            await saveData();
            showNotification('User deleted!');
            updateAdminDashboard();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('usersTab').style.display = tab === 'users' ? 'block' : 'none';
            document.getElementById('investmentsTab').style.display = tab === 'investments' ? 'block' : 'none';
            document.getElementById('withdrawalsTab').style.display = tab === 'withdrawals' ? 'block' : 'none';
            document.getElementById('activitiesTab').style.display = tab === 'activities' ? 'block' : 'none';
        }

        async function logout() {
            currentUser = null;
            await window.storage.delete('currentUser', false);
            
            document.getElementById('dashboardLink').style.display = 'none';
            document.getElementById('logoutLink').style.display = 'none';
            
            document.querySelectorAll('.page, .dashboard').forEach(p => p.classList.remove('active'));
            document.getElementById('homePage').classList.add('active');
            
            showNotification('Logged out successfully!');
        }

        // Close modals when clicking outside
        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
